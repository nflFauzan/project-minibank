<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>Supervisor - Detail Nasabah</title>
  <link rel="stylesheet" th:href="@{/css/cs-shell.css}">
<link rel="stylesheet" th:href="@{/css/custom.css}">
<link rel="stylesheet" th:href="@{/css/minibank-ui.css}">
<link rel="stylesheet" th:href="@{/css/account.css}">
</head>
<body>
<div class="cs-shell">
  <div th:replace="~{cs/fragments :: supervisorSidebar('nasabah')}"></div>

  <div class="cs-content">
    <div th:replace="~{cs/fragments :: topbar}"></div>

    <main class="cs-page">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <div style="font-size:20px; font-weight:900; color:#1e3a8a;">Detail Nasabah (Approval)</div>
        <div style="display:flex; gap:10px;">
          <a th:href="@{/supervisor/nasabah}"
             style="text-decoration:none; padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.12); background:#fff; font-weight:800;">
            Kembali
          </a>
        </div>
      </div>

      <div th:if="${success}" style="margin-top:10px; padding:10px 12px; border-radius:10px; background:#ecfdf5; border:1px solid #bbf7d0; font-weight:800;"
           th:text="${success}"></div>
      <div th:if="${error}" style="margin-top:10px; padding:10px 12px; border-radius:10px; background:#fff7ed; border:1px solid #fed7aa; font-weight:800;"
           th:text="${error}"></div>

      <div style="margin-top:14px; background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:16px; box-shadow:0 10px 25px rgba(0,0,0,.05); padding:16px;">

        <table style="width:100%; border-collapse:collapse; font-size:13px;">
          <tbody>
          <tr><td style="padding:8px; width:220px; color:#64748b; font-weight:800;">ID</td><td style="padding:8px;" th:text="${nasabah.id}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">CIF</td><td style="padding:8px;" th:text="${nasabah.cif}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Status</td><td style="padding:8px;" th:text="${nasabah.status}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Created At</td><td style="padding:8px;" th:text="${nasabah.createdAt}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Created By</td><td style="padding:8px;" th:text="${nasabah.createdBy}"></td></tr>

          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Approved At</td><td style="padding:8px;" th:text="${nasabah.approvedAt}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Approved By</td><td style="padding:8px;" th:text="${nasabah.approvedBy}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Reject Reason</td><td style="padding:8px;" th:text="${nasabah.rejectionReason}"></td></tr>

          <tr><td colspan="2" style="padding:10px 8px; font-weight:900; color:#1e3a8a;">Data Identitas</td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">NIK</td><td style="padding:8px;" th:text="${nasabah.nik}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Nama Lengkap</td><td style="padding:8px;" th:text="${nasabah.namaLengkap}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Tempat Lahir</td><td style="padding:8px;" th:text="${nasabah.tempatLahir}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Tanggal Lahir</td><td style="padding:8px;" th:text="${nasabah.tanggalLahir}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Nama Ibu Kandung</td><td style="padding:8px;" th:text="${nasabah.namaIbuKandung}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Jenis Kelamin</td><td style="padding:8px;" th:text="${nasabah.jenisKelamin}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Penduduk</td><td style="padding:8px;" th:text="${nasabah.penduduk}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Status Pernikahan</td><td style="padding:8px;" th:text="${nasabah.statusPernikahan}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Agama</td><td style="padding:8px;" th:text="${nasabah.agama}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Negara</td><td style="padding:8px;" th:text="${nasabah.negara}"></td></tr>

          <tr><td colspan="2" style="padding:10px 8px; font-weight:900; color:#1e3a8a;">Kontak</td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">No HP</td><td style="padding:8px;" th:text="${nasabah.noHp}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Email</td><td style="padding:8px;" th:text="${nasabah.email}"></td></tr>

          <tr><td colspan="2" style="padding:10px 8px; font-weight:900; color:#1e3a8a;">Alamat Identitas</td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Alamat</td><td style="padding:8px;" th:text="${nasabah.alamatIdentitas}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Kode Pos</td><td style="padding:8px;" th:text="${nasabah.kodePosIdentitas}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Provinsi</td><td style="padding:8px;" th:text="${nasabah.provinsiIdentitas}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Kota</td><td style="padding:8px;" th:text="${nasabah.kotaIdentitas}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Kecamatan</td><td style="padding:8px;" th:text="${nasabah.kecamatanIdentitas}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Kelurahan</td><td style="padding:8px;" th:text="${nasabah.kelurahanIdentitas}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">RT</td><td style="padding:8px;" th:text="${nasabah.rtIdentitas}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">RW</td><td style="padding:8px;" th:text="${nasabah.rwIdentitas}"></td></tr>

          <tr><td colspan="2" style="padding:10px 8px; font-weight:900; color:#1e3a8a;">Alamat Domisili</td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Alamat</td><td style="padding:8px;" th:text="${nasabah.alamatDomisili}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Kode Pos</td><td style="padding:8px;" th:text="${nasabah.kodePosDomisili}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Provinsi</td><td style="padding:8px;" th:text="${nasabah.provinsiDomisili}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Kota</td><td style="padding:8px;" th:text="${nasabah.kotaDomisili}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Kecamatan</td><td style="padding:8px;" th:text="${nasabah.kecamatanDomisili}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Kelurahan</td><td style="padding:8px;" th:text="${nasabah.kelurahanDomisili}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">RT</td><td style="padding:8px;" th:text="${nasabah.rtDomisili}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">RW</td><td style="padding:8px;" th:text="${nasabah.rwDomisili}"></td></tr>

          <tr><td colspan="2" style="padding:10px 8px; font-weight:900; color:#1e3a8a;">Pekerjaan</td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Pekerjaan</td><td style="padding:8px;" th:text="${nasabah.pekerjaan}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Nama Perusahaan</td><td style="padding:8px;" th:text="${nasabah.namaPerusahaan}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Jabatan</td><td style="padding:8px;" th:text="${nasabah.jabatan}"></td></tr>
          <tr><td style="padding:8px; color:#64748b; font-weight:800;">Penghasilan/Bulan</td><td style="padding:8px;" th:text="${nasabah.penghasilanPerBulan}"></td></tr>
          </tbody>
        </table>

      </div>

      <!-- ACTIONS -->
      <div style="margin-top:14px; background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:16px; box-shadow:0 10px 25px rgba(0,0,0,.05); padding:16px;">

        <div style="font-weight:900; color:#1e3a8a; margin-bottom:10px;">Approval Actions</div>

        <!-- Kalau status pending -->
        <div th:if="${nasabah.status.name() == 'INACTIVE'}" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">

          <form method="post" th:action="@{|/supervisor/nasabah/${nasabah.id}/approve|}">
            <input type="hidden"
            th:if="${_csrf != null}"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"/>
            <input type="hidden" name="notes" value=""/>
            <button type="submit"
                    onclick="return confirm('Approve nasabah ini?')"
                    style="padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.12); background:#ecfdf5; font-weight:900; cursor:pointer;">
              Approve
            </button>
          </form>

          <button type="button"
                  onclick="openRejectModal()"
                  style="padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.12); background:#fff7ed; font-weight:900; cursor:pointer;">
            Reject
          </button>

        </div>

        <!-- Kalau sudah approved/rejected -->
        <div th:if="${nasabah.status.name() != 'INACTIVE'}" style="color:#334155; font-weight:800;">
          <div th:if="${nasabah.status.name() == 'ACTIVE'}">
            Nasabah sudah di-approve oleh <span th:text="${nasabah.approvedBy}">-</span>
            pada <span th:text="${nasabah.approvedAt}">-</span>.
          </div>
          <div th:if="${nasabah.status.name() == 'REJECTED'}">
            Nasabah di-reject oleh <span th:text="${nasabah.approvedBy}">-</span>
            pada <span th:text="${nasabah.approvedAt}">-</span>.
            <div style="margin-top:6px;">
              Alasan: <span th:text="${nasabah.rejectionReason}">-</span>
            </div>
          </div>
        </div>

      </div>

      <!-- REJECT MODAL -->
      <div id="rejectModal"
           style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.45); z-index:9999; align-items:center; justify-content:center; padding:16px;">
        <div style="width:min(560px, 100%); background:#fff; border-radius:16px; padding:16px; box-shadow:0 20px 60px rgba(0,0,0,.25);">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
            <div style="font-weight:900; color:#b45309;">Reject Nasabah</div>
            <button type="button" onclick="closeRejectModal()"
                    style="border:1px solid rgba(0,0,0,.12); background:#fff; border-radius:10px; padding:6px 10px; font-weight:900; cursor:pointer;">
              X
            </button>
          </div>

          <form method="post" th:action="@{|/supervisor/nasabah/${nasabah.id}/reject|}" style="margin-top:10px;">
            <input type="hidden"
          th:if="${_csrf != null}"
          th:name="${_csrf.parameterName}"
          th:value="${_csrf.token}"/>

            <label style="display:block; font-weight:900; color:#334155; margin-bottom:6px;">
              Alasan Reject <span style="color:#dc2626;">*</span>
            </label>
            <textarea name="reason" required
                      style="width:100%; min-height:90px; padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.12);"></textarea>

            <label style="display:block; font-weight:900; color:#334155; margin:10px 0 6px;">
              Catatan (opsional)
            </label>
            <textarea name="notes"
                      style="width:100%; min-height:70px; padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.12);"></textarea>

            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:12px;">
              <button type="button" onclick="closeRejectModal()"
                      style="padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.12); background:#fff; font-weight:900; cursor:pointer;">
                Batal
              </button>
              <button type="submit"
                      style="padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.12); background:#fff7ed; font-weight:900; cursor:pointer;">
                Submit Reject
              </button>
            </div>
          </form>
        </div>
      </div>

      <script>
        function openRejectModal() {
          document.getElementById('rejectModal').style.display = 'flex';
        }
        function closeRejectModal() {
          document.getElementById('rejectModal').style.display = 'none';
        }
      </script>

    </main>
  </div>
</div>
</body>
</html>
