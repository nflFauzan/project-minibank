<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CS - Produk Tabungan</title>

<!-- Samakan dengan halaman CS lain -->
<link rel="stylesheet" th:href="@{/css/cs-shell.css}">
<link rel="stylesheet" th:href="@{/css/custom.css}">
<link rel="stylesheet" th:href="@{/css/minibank-ui.css}">
<link rel="stylesheet" th:href="@{/css/account.css}">
</head>

<body>
<div class="cs-shell">
<div th:replace="~{cs/fragments :: sidebar('product')}"></div>

<div class="cs-content">
  <div th:replace="~{cs/fragments :: topbar}"></div>

  <main class="cs-page">
      <h1 class="mb-3">Produk Tabungan</h1>

      <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
      <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

      <div class="mb-3" style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
        <form method="get" th:action="@{/cs/product}" class="toolbar" style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
          <label>
            Status:
            <select name="status">
              <option value="ALL" th:selected="${status == 'ALL'}">Semua</option>
              <option value="ACTIVE" th:selected="${status == 'ACTIVE'}">Aktif</option>
              <option value="INACTIVE" th:selected="${status == 'INACTIVE'}">Nonaktif</option>
            </select>
          </label>

          <div class="btn-ghost">
          <label> 
            Cari:
            <input type="text" name="q" th:value="${q}" placeholder="kode / nama / deskripsi / akad"/>
          </label>
        </div>

          <button type="submit" class="btn">Terapkan</button>
        </form>

        <a th:href="@{/cs/product/new}" class="btn btn-primary">Tambah Produk</a>
      </div>

      <table class="table table-bordered">
        <thead>
        <tr>
          <th>Kode Produk</th>
          <th>Nama Produk</th>
          <th>Jenis Akad</th>
          <th>Setoran Awal Minimum (IDR)</th>
          <th>Status</th>
          <th>Aksi</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${page.totalElements == 0}">
          <td colspan="6">Tidak ada data.</td>
        </tr>

        <tr th:each="p : ${page.content}">
          <td th:text="${p.kodeProduk}"></td>
          <td th:text="${p.namaProduk}"></td>
          <td th:text="${p.jenisAkad}"></td>
          <td th:text="${p.setoranAwalMinimum}"></td>
          <td>
            <span th:if="${p.aktif}">Aktif</span>
            <span th:if="${!p.aktif}">Nonaktif</span>
          </td>
          <td style="display:flex; gap:8px; flex-wrap:wrap;">
            <a th:href="@{/cs/product/{id}(id=${p.id})}">Detail</a>
            <a th:href="@{/cs/product/{id}/edit(id=${p.id})}">Edit</a>

            <form th:action="@{/cs/product/{id}/toggle(id=${p.id})}" method="post" style="display:inline;">
              <input type="hidden" name="q" th:value="${q}">
              <input type="hidden" name="status" th:value="${status}">
              <input type="hidden" name="page" th:value="${page.number}">
              <input type="hidden"
              th:if="${_csrf != null}"
              th:name="${_csrf.parameterName}"
              th:value="${_csrf.token}"/>
              
              <button class="link-danger" type="submit"
                      th:onclick="return confirm([[${p.aktif} ? 'Nonaktifkan produk ini?' : 'Aktifkan produk ini?']]);">
                <span th:text="${p.aktif} ? 'Nonaktifkan' : 'Aktifkan'"></span>
              </button>
            </form>
          </td>
        </tr>
        </tbody>
      </table>

      <div class="mt-3" th:if="${page.totalPages > 1}" style="display:flex; gap:12px; align-items:center;">
        <a th:if="${page.hasPrevious()}"
           th:href="@{/cs/product(page=${page.number-1}, q=${q}, status=${status})}">Prev</a>

        <span>Halaman <span th:text="${page.number + 1}"></span> / <span th:text="${page.totalPages}"></span></span>

        <a th:if="${page.hasNext()}"
           th:href="@{/cs/product(page=${page.number+1}, q=${q}, status=${status})}">Next</a>
      </div>

    </main>
  </div>
</div>
</body>
</html> 